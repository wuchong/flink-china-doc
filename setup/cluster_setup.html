<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT 中文文档: 集群安装</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">中文文档 1.1</a></li>

            <li class="hidden-sm "><a href="/features.html">特性</a></li>

            <!-- Quickstart -->
            <li class="dropdown">
              <a href="/quickstart" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">快速起步<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">安装</a></li>
                
                <li class=""><a href="/quickstart/run_example_quickstart.html">运行实例</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                
              </ul>
            </li>

            <!-- Setup -->
            <li class="dropdown active">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">安装 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/setup/building.html">Build Flink from Source</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>部署</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">本地</a></li>
                
                <li class="active"><a href="/setup/cluster_setup.html">集群 (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">编程指南 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/"><strong>基本概念</strong></a></li>
                
                <li class=""><a href="/apis/streaming/"><strong>Streaming 指南</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/"><strong>Batch Guide</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/cli.html">Command-Line Interface</a></li>
                
                <li class=""><a href="/apis/local_execution.html">Local Execution</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">类库 <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/">Machine Learning</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/table.html">Relational: Table</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">内部 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
              </ul>
            </li>

          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a class="hidden-sm" href="http://blog.flink-china.org" target="_blank">
            <small><span class="glyphicon glyphicon-new-window"></span></small> 博客</a></li>
            <li class="hidden-sm "><a href="/about/">关于本站</a></li>
          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">搜索</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">

  
  
  <div class="col-md-8 col-md-offset-2 text">
    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    
    <div class="panel panel-default">
      <div class="panel-body"><strong>重要</strong>: 依赖于Scala的maven artifacts现在会添加一个Scala主版本的后缀，例如 "2.10" 或 "2.11". 请查阅<a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">迁移指南</a>.</div>
    </div>
    

    <h1>集群安装</h1>


<p>本文主要介绍如何将Flink以分布式模式运行在集群上（可能是异构的）。</p>

<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">环境准备</a>    <ul>
      <li><a href="#ssh-" id="markdown-toc-ssh-">SSH 免密码登录</a></li>
      <li><a href="#javahome" id="markdown-toc-javahome">配置JAVA_HOME</a></li>
    </ul>
  </li>
  <li><a href="#flink" id="markdown-toc-flink">安装 Flink</a></li>
  <li><a href="#flink-1" id="markdown-toc-flink-1">配置 Flink</a></li>
  <li><a href="#flink-2" id="markdown-toc-flink-2">启动 Flink</a></li>
  <li><a href="#jobmanagertaskmanager-" id="markdown-toc-jobmanagertaskmanager-">添加 JobManager/TaskManager 实例到集群中</a>    <ul>
      <li><a href="#jobmanager" id="markdown-toc-jobmanager">添加一个 JobManager</a></li>
      <li><a href="#taskmanager" id="markdown-toc-taskmanager">添加一个 TaskManager</a></li>
    </ul>
  </li>
</ul>

<h2 id="section">环境准备</h2>

<p>Flink 运行在所有<em>类 UNIX 环境</em>上，例如 <strong>Linux</strong>、<strong>Mac OS X</strong> 和 <strong>Cygwin</strong>（对于Windows），而且要求集群由<strong>一个master节点</strong>和<strong>一个或多个worker节点</strong>组成。在安装系统之前，确保<strong>每台机器</strong>上都已经安装了下面的软件：</p>

<ul>
  <li><strong>Java 1.7.x</strong>或更高版本</li>
  <li><strong>ssh</strong>（Flink的脚本会用到sshd来管理远程组件）</li>
</ul>

<p>如果你的集群还没有完全装好这些软件，你需要安装/升级它们。例如，在 Ubuntu Linux 上， 你可以执行下面的命令安装 ssh 和 Java ：</p>

<div class="highlight"><pre><code class="language-bash">sudo apt-get install ssh 
sudo apt-get install openjdk-7-jre</code></pre></div>

<p><a id="passwordless-ssh"></a></p>

<h3 id="ssh-">SSH 免密码登录</h3>

<p><em>译注：安装过 Hadoop、Spark 集群的用户应该对这段很熟悉，如果已经了解，可跳过。</em></p>

<p>为了能够启动/停止远程主机上的进程，master 节点需要能免密登录所有 worker 节点。最方便的方式就是使用ssh的公钥验证了。要安装公钥验证，首先以最终会运行 Flink 的用户登录 master 节点。<strong>所有的 worker 节点上也必须要有同样的用户（例如：使用相同用户名的用户）</strong>。本文会以 <code>flink</code> 用户为例。非常不建议使用 <code>root</code> 账户，这会有很多的安全问题。</p>

<p>当你用需要的用户登录了master节点，你就可以生成一对新的公钥/私钥。下面这段命令会在 ~/.ssh 目录下生成一对新的公钥/私钥。</p>

<div class="highlight"><pre><code class="language-bash">ssh-keygen -b <span class="m">2048</span> -P <span class="s1">&#39;&#39;</span> -f ~/.ssh/id_rsa</code></pre></div>

<p>接下来，将公钥添加到用于认证的<code>authorized_keys</code>文件中：</p>

<div class="highlight"><pre><code class="language-bash">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre></div>

<p>最后，将<code>authorized_keys</code>文件分发给集群中所有的worker节点，你可以重复地执行下面这段命令：</p>

<div class="highlight"><pre><code class="language-bash">scp ~/.ssh/authorized_keys &lt;worker&gt;:~/.ssh/</code></pre></div>

<p>将上面的<code>&lt;worker&gt;</code>替代成相应worker节点的IP/Hostname。完成了上述拷贝的工作，你应该就可以从master上免密登录其他机器了。</p>

<div class="highlight"><pre><code class="language-bash">ssh &lt;worker&gt;</code></pre></div>

<h3 id="javahome">配置JAVA_HOME</h3>

<p>Flink 需要master和worker节点都配置了<code>JAVA_HOME</code>环境变量。有两种方式可以配置。</p>

<p>一种是，你可以在<code>conf/flink-conf.yaml</code>中设置<code>env.java.home</code>配置项为Java的安装路径。</p>

<p>另一种是，<code>sudo vi /etc/profile</code>，在其中添加<code>JAVA_HOME</code>：</p>

<div class="highlight"><pre><code class="language-bash"><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/path/to/java_home/</code></pre></div>

<p>然后使环境变量生效，并验证 Java 是否安装成功</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span><span class="nb">source</span> /etc/profile   <span class="c">#生效环境变量</span>
<span class="nv">$ </span>java -version         <span class="c">#如果打印出版本信息，则说明安装成功</span>
java version <span class="s2">&quot;1.7.0_75&quot;</span>
Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.7.0_75-b13<span class="o">)</span>
Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 24.75-b04, mixed mode<span class="o">)</span></code></pre></div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="flink">安装 Flink</h2>

<p>进入<a href="http://flink.apache.org/downloads.html">下载页面</a>。请选择一个与你的Hadoop版本相匹配的Flink包。如果你不打算使用Hadoop，选择任何版本都可以。</p>

<p>在下载了最新的发布包后，拷贝到master节点上，并解压：</p>

<div class="highlight"><pre><code class="language-bash">tar xzf flink-*.tgz
<span class="nb">cd </span>flink-*</code></pre></div>

<h2 id="flink-1">配置 Flink</h2>

<p>在解压完之后，你需要编辑<code>conf/flink-conf.yaml</code>配置Flink。</p>

<p>设置<code>jobmanager.rpc.address</code>配置项为你的master节点地址。另外为了明确 JVM 在每个节点上所能分配的最大内存，我们需要配置<code>jobmanager.heap.mb</code>和<code>taskmanager.heap.mb</code>，值的单位是 MB。如果对于某些worker节点，你想要分配更多的内存给Flink系统，你可以在相应节点上设置<code>FLINK_TM_HEAP</code>环境变量来覆盖默认的配置。</p>

<p>最后，你需要提供一个集群中worker节点的列表。因此，就像配置HDFS，编辑<em>conf/slaves</em>文件，然后输入每个worker节点的 IP/Hostname。每一个worker结点之后都会运行一个 TaskManager。</p>

<p>每一条记录占一行，就像下面展示的一样：</p>

<div class="highlight"><pre><code class="language-bash">192.168.0.100
192.168.0.101
.
.
.
192.168.0.150</code></pre></div>

<p><em>译注：conf/master文件是用来做 <a href="setup/jobmanager_high_availability.html">JobManager HA</a> 的，在这里不需要配置</em></p>

<p>每一个worker节点上的 Flink 路径必须一致。你可以使用共享的 NSF 目录，或者拷贝整个 Flink 目录到各个worker节点。</p>

<div class="highlight"><pre><code class="language-bash">scp -r /path/to/flink &lt;worker&gt;:/path/to/</code></pre></div>

<p>请查阅<a href="config.html">配置页面</a>了解更多关于Flink的配置。</p>

<p>特别的，这几个</p>

<ul>
  <li>TaskManager 总共能使用的内存大小（<code>taskmanager.heap.mb</code>）</li>
  <li>每一台机器上能使用的 CPU 个数（<code>taskmanager.numberOfTaskSlots</code>）</li>
  <li>集群中的总 CPU 个数（<code>parallelism.default</code>）</li>
  <li>临时目录（<code>taskmanager.tmp.dirs</code>）</li>
</ul>

<p>是非常重要的配置项。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="flink-2">启动 Flink</h2>

<p>下面的脚本会在本地节点启动一个 JobManager，然后通过 SSH 连接所有的worker节点（<em>slaves</em>文件中所列的节点），并在每个节点上运行 TaskManager。现在你的 Flink 系统已经启动并运行了。跑在本地节点上的 JobManager 现在会在配置的 RPC 端口上监听并接收任务。</p>

<p>假定你在master节点上，并在Flink目录中：</p>

<div class="highlight"><pre><code class="language-bash">bin/start-cluster.sh</code></pre></div>

<p>要停止Flink，也有一个 <em>stop-cluster.sh</em> 脚本。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="jobmanagertaskmanager-">添加 JobManager/TaskManager 实例到集群中</h2>

<p>你可以使用 <em>bin/jobmanager.sh</em> 和 <em>bin/taskmanager</em> 脚本来添加 JobManager 和 TaskManager 实例到你正在运行的集群中。</p>

<h3 id="jobmanager">添加一个 JobManager</h3>

<div class="highlight"><pre><code class="language-bash">bin/jobmanager.sh <span class="o">(</span>start cluster<span class="o">)</span><span class="p">|</span>stop<span class="p">|</span>stop-all</code></pre></div>

<h3 id="taskmanager">添加一个 TaskManager</h3>

<div class="highlight"><pre><code class="language-bash">bin/taskmanager.sh start<span class="p">|</span>stop<span class="p">|</span>stop-all</code></pre></div>

<p>确保你是在需要启动/停止相应实例的节点上运行的这些脚本。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

     <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/wuchong/flink-china-doc/edit/master/setup/cluster_setup.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
  </div>
  

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <!-- script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script -->

    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>


    <!-- Disqus -->
    
  </body>
</html>
